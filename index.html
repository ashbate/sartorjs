<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Graph Network</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f4f8;
      font-family: 'Arial', sans-serif;
    }

    svg {
      width: 100%;
      max-width: 1200px;
      height: 600px;
    }

    .node {
      transition: all 0.3s ease;
    }

    .node:hover {
      cursor: pointer;
      filter: brightness(1.2);
    }

    .link {
      stroke-linecap: round;
      transition: stroke-width 0.2s ease;
    }

    .trail {
      transition: opacity 2s ease-out;
    }
  </style>
</head>
<body>
  <svg id="graph-network"></svg>

  <script>
    function createGraphNetwork() {
      const svg = d3.select("#graph-network");
      const width = 1200;
      const height = 600;
      const centerX = width / 2;
      const centerY = height / 2;

      // Node configuration
      const nodes = [
        { id: 'Left1', x: centerX * 0.25, y: centerY * 0.6, color: '#3498db' },
        { id: 'Left2', x: centerX * 0.25, y: centerY * 1.4, color: '#2ecc71' },
        { id: 'Center', x: centerX, y: centerY, color: '#f39c12', radius: 30 },
        { id: 'Right1', x: centerX * 1.75, y: centerY * 0.6, color: '#9b59b6' },
        { id: 'Right2', x: centerX * 1.75, y: centerY * 1.4, color: '#e74c3c' }
      ];

      // Journey configurations
      const journeys = [
        { path: ['Left1', 'Center', 'Right1'] },
        { path: ['Left2', 'Center', 'Right2'] }
      ];

      // Render links
      const links = svg.selectAll('.link')
        .data(journeys)
        .enter()
        .append('path')
        .attr('class', 'link')
        .attr('fill', 'none')
        .attr('stroke', '#bdc3c7')
        .attr('stroke-width', 5)
        .attr('d', journey => {
          const points = journey.path.map(id => 
            nodes.find(node => node.id === id)
          );
          return d3.line()
            .curve(d3.curveBasis)
            (points.map(p => [p.x, p.y]));
        });

      // Render nodes
      const nodeElements = svg.selectAll('.node')
        .data(nodes)
        .enter()
        .append('circle')
        .attr('class', 'node')
        .attr('cx', d => d.x)
        .attr('cy', d => d.y)
        .attr('r', d => d.radius || 20)
        .attr('fill', d => d.color)
        .attr('stroke', '#2c3e50')
        .attr('stroke-width', 2);

      // Add node labels
      svg.selectAll('.node-label')
        .data(nodes)
        .enter()
        .append('text')
        .attr('x', d => d.x)
        .attr('y', d => d.y - 30)
        .attr('text-anchor', 'middle')
        .attr('fill', '#2c3e50')
        .text(d => d.id);

      // Animate traversal
      function animateTraversal() {
        journeys.forEach((journey, index) => {
          const dot = svg.append('circle')
            .attr('class', 'traversal-dot')
            .attr('r', 8)
            .attr('fill', '#e67e22')
            .style('opacity', 1);

          const trail = svg.append('path')
            .attr('class', 'trail')
            .attr('fill', 'none')
            .attr('stroke', '#e67e22')
            .attr('stroke-width', 6)
            .style('opacity', 0.7);

          const points = journey.path.map(id => 
            nodes.find(node => node.id === id)
          );

          const line = d3.line().curve(d3.curveBasis);
          const pathData = line(points.map(p => [p.x, p.y]));

          const pathLength = svg.append('path').attr('d', pathData).node().getTotalLength();

          function animate() {
            dot.transition()
              .duration(3000)
              .attrTween('transform', () => {
                return t => {
                  const point = svg.append('path').attr('d', pathData).node().getPointAtLength(t * pathLength);
                  return `translate(${point.x},${point.y})`;
                };
              })
              .on('start', function repeatAnimation() {
                d3.select(this)
                  .transition()
                  .duration(0)
                  .attr('transform', 'translate(0,0)')
                  .transition()
                  .duration(3000)
                  .attrTween('transform', () => {
                    return t => {
                      const point = svg.append('path').attr('d', pathData).node().getPointAtLength(t * pathLength);
                      return `translate(${point.x},${point.y})`;
                    };
                  })
                  .on('start', repeatAnimation);
              });

            trail.attr('d', pathData)
              .transition()
              .duration(3000)
              .attrTween('stroke-dasharray', () => {
                const length = trail.node().getTotalLength();
                return d3.interpolate(`0,${length}`, `${length},0`);
              });
          }

          // Stagger the start of each journey
          setTimeout(animate, index * 1500);
        });
      }

      // Start the animation
      animateTraversal();
    }

    // Initialize the graph network
    createGraphNetwork();
  </script>
</body>
</html>
